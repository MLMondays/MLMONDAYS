<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Blog · &quot;ML Mondays&quot;</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="A weekly USGS-CDI course on image analysis using machine learning"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Blog · &quot;ML Mondays&quot;"/><meta property="og:type" content="website"/><meta property="og:url" content="https://dbuscombe-usgs.github.io/DL-CDI2020/"/><meta property="og:description" content="A weekly USGS-CDI course on image analysis using machine learning"/><meta property="og:image" content="https://dbuscombe-usgs.github.io/DL-CDI2020/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://dbuscombe-usgs.github.io/DL-CDI2020/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/DL-CDI2020/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://dbuscombe-usgs.github.io/DL-CDI2020/blog/atom.xml" title="&quot;ML Mondays&quot; Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://dbuscombe-usgs.github.io/DL-CDI2020/blog/feed.xml" title="&quot;ML Mondays&quot; Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/DL-CDI2020/js/scrollSpy.js"></script><link rel="stylesheet" href="/DL-CDI2020/css/main.css"/><script src="/DL-CDI2020/js/codetabs.js"></script></head><body class="blog"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/DL-CDI2020/"><img class="logo" src="/DL-CDI2020/img/favicon.ico" alt="&quot;ML Mondays&quot;"/><h2 class="headerTitleWithLogo">&quot;ML Mondays&quot;</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/DL-CDI2020/docs/doc1" target="_self">Docs</a></li><li class=""><a href="/DL-CDI2020/docs/doc2" target="_self">Data</a></li><li class=""><a href="/DL-CDI2020/help" target="_self">Help</a></li><li class="siteNavGroupActive siteNavItemActive"><a href="/DL-CDI2020/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Recent Posts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Recent Posts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/DL-CDI2020/blog/2020/08/05/blog-post">Trimming and decompiling a video into png image files, for use in your deep learning project</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="posts"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/DL-CDI2020/blog/2020/08/05/blog-post">Trimming and decompiling a video into png image files, for use in your deep learning project</a></h1><p class="post-meta">August 5, 2020</p><div class="authorBlock"><p class="post-authorName"><a href="http://twitter.com/magic_walnut" target="_blank" rel="noreferrer noopener">Dan Buscombe</a></p></div></header><article class="post-content"><div><span><p><img src="/DL-CDI2020/blog/assets/secoora.png" alt=""></p>
<p>You can access from the NOAA NOS Web Camera Applications Testbed (WebCAT) <a href="https://secoora.org/webcat/">Live Cameras and Historic Feeds</a> site. The image above shows how to view the image I will use in the demonstration below.</p>
<p>To extract a subsection (or trim) of the file  <code>staugustinecam.2019-01-11_0900.mp4</code>, from 1 min 47 s to 6 min 22 s, and output it to the file <code>staugustinecam.2019-01-11_0900_trim.mp4</code>:</p>
<pre><code class="hljs">ffmpeg -i staugustinecam<span class="hljs-number">.2019</span><span class="hljs-number">-01</span><span class="hljs-number">-11</span>_0900.mp4 -ss <span class="hljs-number">00</span>:<span class="hljs-number">01</span>:<span class="hljs-number">47</span> -t <span class="hljs-number">00</span>:<span class="hljs-number">06</span>:<span class="hljs-number">22</span> -async <span class="hljs-number">1</span> staugustinecam<span class="hljs-number">.2019</span><span class="hljs-number">-01</span><span class="hljs-number">-11</span>_0900_trim.mp4
</code></pre>
<p>To extract <code>png</code> format files from that trimmed video, writing the frame number to the file name:</p>
<pre><code class="hljs">ffmpeg -i staugustinecam<span class="hljs-number">.2019</span><span class="hljs-number">-01</span><span class="hljs-number">-11</span>_0900_trim.mp4 staugustinecam<span class="hljs-number">.2019</span><span class="hljs-number">-01</span><span class="hljs-number">-11</span>_0900_%d.png
</code></pre>
<p>Make a directory:</p>
<pre><code class="hljs">mkdir staugustinecam_2019<span class="hljs-number">-01</span><span class="hljs-number">-11</span>_0900
</code></pre>
<p>Move all of the <code>png</code> files into that directory:</p>
<pre><code class="hljs">mv *.png staugustinecam_2019<span class="hljs-number">-01</span><span class="hljs-number">-11</span>_0900
</code></pre>
<p>Make a bash script so you can execute the decompiling (only) sequence of commands on an arbitrary mp4 file from the command line. First, open a new file called <code>nano decompile_mp4.sh</code>:</p>
<pre><code class="hljs"><span class="hljs-selector-tag">nano</span> <span class="hljs-selector-tag">decompile_mp4</span><span class="hljs-selector-class">.sh</span>
</code></pre>
<p>and write or copy the following into it:</p>
<pre><code class="hljs">echo <span class="hljs-string">"decompiling video file $1, and moving png frames into $2, in T minus 5 seconds ..."</span>
<span class="hljs-keyword">sleep</span> <span class="hljs-number">5</span><span class="hljs-keyword">s</span>
ffmpeg -i $1 $2<span class="hljs-number">_</span>%d.png
<span class="hljs-keyword">mkdir</span> $2
mv *.png $2
</code></pre>
<p>To exit <code>nano</code>:</p>
<p><code>Ctrl+X</code> (for exit)
<code>Y</code> (for yes)
<code>enter</code> (for save)</p>
<p>Use it like this:</p>
<pre><code class="hljs"><span class="hljs-selector-tag">bash</span> <span class="hljs-selector-tag">decompile_mp4</span><span class="hljs-selector-class">.sh</span> <span class="hljs-selector-tag">myvid</span><span class="hljs-selector-class">.mp4</span> <span class="hljs-selector-tag">myframes</span>
</code></pre>
<p>To extract 1 frame per minute, modify to:</p>
<pre><code class="hljs">echo <span class="hljs-string">"decompiling video file $1 - one frame every minute, and moving png frames into $2, in T minus 5 seconds ..."</span>
<span class="hljs-keyword">sleep</span> <span class="hljs-number">5</span><span class="hljs-keyword">s</span>
ffmpeg -i $1 -vf fps=<span class="hljs-number">1</span>/<span class="hljs-number">60</span> $2<span class="hljs-number">_</span>%d.png
<span class="hljs-keyword">mkdir</span> $2
mv *.png $2
</code></pre>
<p>Let's say you've carried out the above procedure on lots of videos and you have lots of folders containing frames. Now you want to randomly move some images from each directory into three separate folders that you'll use in your deep learning project, called <code>test</code>, <code>train</code>, and <code>validate</code> (it is also common to use <code>test</code> for the purposes of both testing and validating)</p>
<pre><code class="hljs"><span class="hljs-keyword">mkdir</span> train
<span class="hljs-keyword">mkdir</span> <span class="hljs-keyword">test</span>
<span class="hljs-keyword">mkdir</span> validate
</code></pre>
<p>To move 10 random files to each from a directory called <code>my_directory</code> containing png frames:</p>
<pre><code class="hljs">cd my_directory
shuf -n <span class="hljs-number">10</span> -e * | xargs -i <span class="hljs-class">mv </span>{} ..<span class="hljs-meta-keyword">/train/</span>
shuf -n <span class="hljs-number">10</span> -e * | xargs -i <span class="hljs-class">mv </span>{} ..<span class="hljs-meta-keyword">/test/</span>
shuf -n <span class="hljs-number">10</span> -e * | xargs -i <span class="hljs-class">mv </span>{} ..<span class="hljs-meta-keyword">/validate/</span>
</code></pre>
<p>or to generalize:</p>
<pre><code class="hljs"><span class="hljs-keyword">for</span> direc <span class="hljs-keyword">in</span> st*/
<span class="hljs-keyword">do</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$direc</span>
shuf -n 10 -e * | xargs -i mv {} ../train/
shuf -n 10 -e * | xargs -i mv {} ../<span class="hljs-built_in">test</span>/
shuf -n 10 -e * | xargs -i mv {} ../validate/  
<span class="hljs-built_in">cd</span> ..
<span class="hljs-keyword">done</span>
</code></pre>
<p>In the above, I say <code>st*/</code> to list only directories beginning with <code>st</code>, rather than listing all directories (<code>/*</code>), which would include <code>test</code>, <code>train</code>, and <code>validate</code> and would not work</p>
<p>Finally, to convert all png files to jpg files, use:</p>
<pre><code class="hljs"><span class="hljs-attribute">mogrify</span> -format jpg <span class="hljs-regexp">*.png</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/DL-CDI2020/" class="nav-home"><img src="/DL-CDI2020/img/favicon.ico" alt="&quot;ML Mondays&quot;" width="66" height="58"/></a><div><h5>Internal links</h5><a href="/DL-CDI2020/docs/en/doc1.html">Docs</a><a href="/DL-CDI2020/docs/en/doc2.html">Data</a><a href="/DL-CDI2020/docs/en/doc3.html">Help</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://www.usgs.gov/centers/cdi" target="_blank" rel="noreferrer noopener">USGS Community for Data Integration (CDI)</a><a href="https://www.usgs.gov/centers/pcmsc/science/remote-sensing-coastal-change?qt-science_center_objects=0#qt-science_center_objects" target="_blank" rel="noreferrer noopener">USGS Remote Sensing Coastal Change Project</a><a href="https://www.danielbuscombe.com" target="_blank" rel="noreferrer noopener">www.danielbuscombe.com</a></div><div><h5>More</h5><a href="/DL-CDI2020/blog">Blog</a><a href="https://github.com/dbuscombe-usgs/DL-CDI2020">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><div class="social"><a href="https://twitter.com/magic_walnut" class="twitter-follow-button">Follow @magic_walnut</a></div></div></section><a href="https://mardascience.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/DL-CDI2020/img/dash-logo-new.png" alt="Marda Science" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Marda Science, LLC</section></footer></div><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script></body></html>